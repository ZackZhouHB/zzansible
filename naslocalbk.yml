---
- name: nas config backup demo
  hosts: nas
  tasks:
   - name: Create backup directory
     file:
       path: /data/bk
       state: directory


- name: cd and tar freenas config db file
  hosts: nas
  tasks:
   - name: cd and tar
     shell:
       chdir: /data/bk
       cmd: tar fczP freenas-v1.db.tar /data/freenas-v1.db
   - name: fetch tar file to local
     fetch:
       src: /data/bk/freenas-v1.db.tar
       dest: /root/nasbk
   - name: upload to s3
     aws_s3:
         bucket: arn:aws:s3:::zackzs3001/nasbk/
         object: /root/nasbk/
         src: /root/nasbk/
         mode: put
